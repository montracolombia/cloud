<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Calculadora ROI CubiScan - Montra</title>
    <style>
        :root {
            --primary: #ff0000;
            --secondary: #cc0000;
            --light: #ffffff;
            --dark: #1a1a1a;
            --grey: #767676;
            --light-grey: #e0e0e0;
            --dark-grey: #333333;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            --transition: all 0.3s ease;
            --frame-height: 70px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f8f8f8;
            color: #333333;
            line-height: 1.6;
            padding: 20px;
            padding-bottom: 20px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .navbar {
            background-color: var(--dark);
            color: var(--light);
            padding: 10px 0;
            margin-bottom: 20px;
            border-radius: var(--border-radius);
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            width: 100%;
            height: var(--frame-height);
        }
        
        .navbar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 100%;
            padding: 0 20px;
        }

        .logo-wrapper {
            display: flex;
            align-items: center;
            height: 50px;
        }

        .logo {
            max-height: 100%;
            max-width: 100%;
            object-fit: contain;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            flex: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: var(--dark);
        }

        .header h1 {
            color: var(--dark);
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .calculators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .calculator-card {
            background: var(--light);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            transition: transform 0.3s ease;
            border: 1px solid #ddd;
        }

        .calculator-card:hover {
            transform: translateY(-5px);
        }

        .calculator-title {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            margin: -25px -25px 20px -25px;
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 600;
            font-size: 0.9em;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            font-size: 1em;
            transition: border-color 0.3s;
            background-color: #fffacd;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .input-group input:disabled {
            background-color: #f0f0f0;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .result-section {
            background: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
        }

        .result-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin-bottom: 8px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid var(--primary);
        }

        .result-label {
            font-weight: 600;
            color: #555;
        }

        .result-value {
            font-weight: bold;
            color: var(--primary);
        }

        .roi-highlight {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
            margin-top: 15px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .subtitle {
            font-size: 0.85em;
            color: #666;
            font-style: italic;
            margin-top: 5px;
        }

        .footer {
            text-align: center;
            background-color: var(--dark);
            color: var(--light);
            height: var(--frame-height);
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            margin-top: 30px;
            margin-bottom: 0;
            border-radius: var(--border-radius);
        }

        button {
            cursor: pointer;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 10px 20px;
            font-size: 0.95rem;
            font-weight: 600;
            transition: var(--transition);
        }

        button:hover {
            background-color: var(--secondary);
            transform: translateY(-2px);
        }

        button.logout {
            background-color: var(--grey);
        }

        button.logout:hover {
            background-color: #555;
        }

        .error-message {
            background-color: #fee;
            color: var(--primary);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid var(--primary);
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: var(--grey);
        }

        @media (max-width: 768px) {
            .calculators-grid {
                grid-template-columns: 1fr;
            }

            .navbar-content {
                flex-direction: column;
                gap: 10px;
                padding: 10px;
            }
        }

        /* Mejoras para una sola calculadora */
        .calculators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
            justify-items: center;
        }

        /* Cuando hay solo 1 calculadora, centrarla y limitar ancho */
        .calculators-grid:has(.calculator-card:only-child) {
            grid-template-columns: 1fr;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Inputs m치s compactos */
        .input-group input {
            width: 100%;
            padding: 10px 12px;
            font-size: 0.95em;
        }

        /* Mejoras responsive para botones */
        .nav-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .calculators-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-buttons {
                justify-content: center;
                width: 100%;
            }
            
            .nav-buttons button {
                flex: 1;
                min-width: 120px;
            }
        }

        @media (max-width: 480px) {
            .calculators-grid {
                gap: 15px;
            }
            
            .calculator-card {
                padding: 20px;
            }
            
            .nav-buttons button {
                width: 100%;
                min-width: auto;
            }

            /* Fix para navbar responsive */
            .navbar-content {
                display: flex;
                justify-content: space-between;
                align-items: center;
                height: 100%;
                padding: 0 20px;
                flex-wrap: wrap;
                gap: 10px;
            }

            @media (max-width: 768px) {
                .navbar {
                    height: auto;
                    min-height: var(--frame-height);
                }
                
                .navbar-content {
                    flex-direction: column;
                    padding: 15px;
                    justify-content: center;
                }
                
                .logo-wrapper {
                    margin-bottom: 10px;
                }
                
                .nav-buttons {
                    width: 100%;
                    justify-content: center;
                }
            }

            @media (max-width: 480px) {
                .header h1 {
                    font-size: 1.8rem;
                }
                
                .header p {
                    font-size: 0.95rem;
                }
                
                .calculator-card {
                    padding: 15px;
                }
                
                .calculator-title {
                    font-size: 1.1em;
                    padding: 12px;
                    margin: -15px -15px 15px -15px;
                }
                
                .result-section {
                    padding: 15px;
                }
                
                .result-section h3 {
                    font-size: 1em;
                }
            }
        }

        /* FIX VIEWPORT Y CONTENEDORES BASE */
        html, body {
            width: 100%;
            max-width: 100vw;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
        }

        .container {
            width: 100% !important;
            max-width: 1200px;
            padding: 0 10px;
            margin: 0 auto;
        }

        .content-wrapper {
            width: 100% !important;
            max-width: 1200px;
            padding: 20px 10px;
        }

        /* FIX NAVBAR - EVITAR SOBREPOSICI칍N DE BOTONES */
        .navbar {
            width: 100%;
            min-height: var(--frame-height);
            height: auto;
        }

        .navbar-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            gap: 20px;
            flex-wrap: wrap;
        }

        .logo-wrapper {
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-shrink: 0;
        }

        .nav-buttons button {
            white-space: nowrap;
            padding: 10px 20px;
            min-width: fit-content;
        }

        /* RESPONSIVE TABLET */
        @media (max-width: 1024px) {
            .navbar-content {
                padding: 10px 15px;
                gap: 15px;
            }
            
            .nav-buttons button {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
        }

        /* RESPONSIVE M칍VIL */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .navbar {
                width: 100% !important;
                max-width: 100%;
                margin-bottom: 15px;
                height: auto;
                min-height: var(--frame-height);
            }
            
            .navbar-content {
                flex-direction: column;
                padding: 10px;
                height: auto;
                gap: 10px;
                align-items: center;
            }
            
            .logo-wrapper {
                width: 100%;
                justify-content: center;
                margin-bottom: 10px;
            }
            
            .nav-buttons {
                width: 100%;
                justify-content: center;
                gap: 10px;
            }
            
            .nav-buttons button {
                flex: 1;
                min-width: 120px;
                max-width: 200px;
                margin: 0 !important;
            }
            
            .card {
                width: 100% !important;
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .header p {
                font-size: 0.9rem;
            }
            
            .footer {
                width: 100% !important;
                max-width: 100%;
                height: auto;
                min-height: var(--frame-height);
                padding: 15px 10px;
                margin-top: 20px;
                font-size: 0.85rem;
            }
            
            #login-form,
            #search-form {
                width: 100% !important;
            }
            
            input,
            select,
            button {
                width: 100% !important;
                font-size: 16px !important;
            }
            
            button {
                margin-right: 0 !important;
                margin-bottom: 10px;
            }
            
            /* PARA CALCULADORA */
            .calculators-grid {
                grid-template-columns: 1fr !important;
                gap: 15px;
            }
            
            .calculator-card {
                padding: 15px;
                width: 100% !important;
            }
            
            .calculator-title {
                font-size: 1em;
                padding: 12px;
                margin: -15px -15px 15px -15px;
            }
            
            .input-group {
                margin-bottom: 12px;
            }
            
            .input-group input {
                width: 100% !important;
                font-size: 16px !important;
            }
            
            .input-group label {
                font-size: 0.85rem;
            }
            
            .calculate-button {
                width: 100% !important;
                padding: 12px !important;
            }
            
            .result-section {
                padding: 12px;
            }
            
            .result-section h3 {
                font-size: 0.95em;
            }
            
            .result-row {
                font-size: 0.85rem;
                padding: 8px 0;
            }
        }

        /* RESPONSIVE M칍VIL PEQUE칌O */
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .navbar {
                border-radius: 6px;
            }
            
            .card {
                padding: 12px;
                border-radius: 6px;
            }
            
            .header h1 {
                font-size: 1.3rem;
            }
            
            .header p {
                font-size: 0.85rem;
            }
            
            .footer {
                font-size: 0.75rem;
                padding: 10px 5px;
            }
            
            .nav-buttons {
                flex-direction: column;
                width: 100%;
            }
            
            .nav-buttons button {
                width: 100% !important;
                min-width: auto;
                max-width: none;
            }
            
            /* PARA CALCULADORA */
            .calculator-card {
                padding: 12px;
            }
            
            .calculator-title {
                font-size: 0.95em;
                padding: 10px;
                margin: -12px -12px 12px -12px;
            }
            
            .result-section h3 {
                font-size: 0.9em;
            }
            
            .result-row {
                font-size: 0.8rem;
            }
        }

        /* FIX LANDSCAPE M칍VIL */
        @media (max-height: 500px) and (orientation: landscape) {
            .navbar {
                height: 50px;
                min-height: 50px;
            }
            
            .footer {
                height: 50px;
                min-height: 50px;
            }
            
            .card {
                padding: 10px;
            }
            
            .header {
                margin-bottom: 10px;
            }
            
            .header h1 {
                font-size: 1.2rem;
            }
            
            .calculator-card {
                padding: 10px;
            }
        }





    </style>
</head>
<body>
    <div class="navbar">
        <div class="navbar-content">
            <div class="logo-wrapper">
                <img src="Montra.png" alt="Logo Montra" class="logo">
            </div>
            <div class="nav-buttons">
                <button class="logout" onclick="logout()">Cerrar Sesi칩n</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>游닍 Calculadora ROI - Equipos CubiScan</h1>
            <p>Calcule el retorno de inversi칩n de sus equipos</p>
        </div>

        <div id="error-container"></div>
        <div id="loading-container" class="loading">Cargando configuraci칩n...</div>

        <div class="calculators-grid" id="calculators-container" style="display: none;">
            <!-- Las calculadoras se cargar치n din치micamente aqu칤 -->
        </div>
    </div>

    <div class="footer">
        <p>춸 2025 Montra Solutions | L칤der en cadena de suministros</p>
    </div>

    <script>
        const API_URL = 'https://fastapi-backend-201226788937.us-central1.run.app';
        //const API_URL= 'http://127.0.0.1:8080'
        const DIAS_SEMANA = 5;
        const SEMANAS_MES = 4;
        const DIAS_MES = DIAS_SEMANA * SEMANAS_MES;

        // Configuraci칩n de las calculadoras
        const calculatorConfigs = {
            'calculator1': {
                title: 'CubiScan Est치tico',
                subtitle: 'Paquetes Throughput Bajo',
                defaultCost: 50000,
                fields: [
                    { id: 'piezas', label: 'Cantidad de piezas por d칤a', default: 2000, type: 'number' },
                    { id: 'tarifa', label: 'Tarifa promedio de venta del cliente (USD/kg)', default: 0.5, type: 'number', step: '0.01' },
                    { id: 'peso_paquete', label: 'Peso promedio de paquete (kg)', default: 10, type: 'number', step: '0.01' },
                    { id: 'incidencia', label: 'Incidencia promedio % peso volumen > peso real', default: 30, type: 'number', step: '0.01', subtitle: 'Porcentaje expresado como n칰mero (ej: 30 para 30%)' }
                ],
                calculate: 'calculateType1'
            },
            'calculator2': {
                title: 'CubiScan para Sobredimensionados',
                subtitle: 'Paquetes Grandes',
                defaultCost: 150000,
                fields: [
                    { id: 'piezas', label: 'Cantidad de piezas por d칤a', default: 500, type: 'number' },
                    { id: 'tarifa', label: 'Tarifa promedio de venta del cliente (USD/kg)', default: 0.5, type: 'number', step: '0.01' },
                    { id: 'peso_paquete', label: 'Peso promedio de paquete (kg)', default: 80, type: 'number', step: '0.01' },
                    { id: 'relacion', label: 'Relaci칩n peso volum칠trico vs real', default: 2.5, type: 'number', step: '0.1', subtitle: 'Ejemplo: 2.5 significa que el peso volum칠trico es 2.5 veces el peso real' }
                ],
                calculate: 'calculateType2'
            },
            'calculator3': {
                title: 'CubiScan Din치mico',
                subtitle: 'Paquetes Throughput Alto',
                defaultCost: 130000,
                fields: [
                    { id: 'piezas', label: 'Cantidad de piezas por d칤a', default: 5000, type: 'number' },
                    { id: 'tarifa', label: 'Tarifa promedio de venta del cliente (USD/kg)', default: 0.5, type: 'number', step: '0.01' },
                    { id: 'peso_paquete', label: 'Peso promedio de paquete (kg)', default: 10, type: 'number', step: '0.01' },
                    { id: 'incidencia', label: 'Incidencia promedio % peso volumen > peso real', default: 30, type: 'number', step: '0.01', subtitle: 'Porcentaje expresado como n칰mero (ej: 30 para 30%)' }
                ],
                calculate: 'calculateType1'
            }
        };

        let userConfig = null;

        function formatNumber(num) {
            return new Intl.NumberFormat('es-CO', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(num);
        }

        async function loadUserConfig() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    showError('No se encontr칩 token de autenticaci칩n.');
                    return;
                }

                // Mostrar mensaje de carga
                document.getElementById('loading-container').textContent = 'Cargando configuraci칩n de calculadoras...';

                const response = await fetch(`${API_URL}/calculator/config`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    if (response.status === 403) {
                        showError('No tiene calculadoras asignadas. Contacte al administrador.');
                        return;
                    }
                    if (response.status === 401) {
                        showError('Sesi칩n expirada. Redirigiendo al login...');
                        setTimeout(() => {
                            localStorage.clear();
                            window.location.href = 'index.html';
                        }, 2000);
                        return;
                    }
                    throw new Error(`Error ${response.status}: ${response.statusText}`);
                }

                userConfig = await response.json();
                
                // Validar que tenga calculadoras
                if (!userConfig || !userConfig.calculators || userConfig.calculators.length === 0) {
                    showError('No tiene calculadoras asignadas. Contacte al administrador.');
                    return;
                }

                document.getElementById('loading-container').style.display = 'none';
                renderCalculators();
                
            } catch (error) {
                console.error('Error completo:', error);
                document.getElementById('loading-container').style.display = 'none';
                showError(`Error al cargar la configuraci칩n: ${error.message}`);
            }
        }

        function showError(message) {
            const errorContainer = document.getElementById('error-container');
            errorContainer.innerHTML = `
                <div class="error-message">
                    <strong>丘멆잺 Error:</strong> ${message}<br><br>
                    <p style="margin-top: 10px;">
                        Por favor contacte al administrador para que le asigne calculadoras.<br>
                        Ser치s redirigido al inicio en 3 segundos...
                    </p>
                </div>
            `;
            
            // Redirigir despu칠s de 3 segundos
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 3000);
        }

        function renderCalculators() {
            const container = document.getElementById('calculators-container');
            container.innerHTML = '';

            if (!userConfig || !userConfig.calculators || userConfig.calculators.length === 0) {
                showError('No tiene calculadoras asignadas');
                return;
            }

            userConfig.calculators.forEach(calc => {
                const config = calculatorConfigs[calc.calculator_id];
                if (!config) return;

                const calculatorDiv = document.createElement('div');
                calculatorDiv.className = 'calculator-card';
                calculatorDiv.innerHTML = createCalculatorHTML(calc.calculator_id, config, calc.equipment_cost, calc.can_edit_cost);
                container.appendChild(calculatorDiv);
            });

            container.style.display = 'grid';

            // Inicializar c치lculos
            userConfig.calculators.forEach(calc => {
                if (calculatorConfigs[calc.calculator_id]) {
                    window[calculatorConfigs[calc.calculator_id].calculate](calc.calculator_id);
                }
            });
        }

        function createCalculatorHTML(id, config, equipmentCost, canEditCost) {
            let html = `
                <div class="calculator-title">${config.title}<br><span style="font-size:0.7em">${config.subtitle}</span></div>
                
                ${config.fields.map(field => `
                    <div class="input-group">
                        <label>${field.label}</label>
                        <input type="${field.type}" 
                               id="${id}_${field.id}" 
                               value="${field.default}" 
                               ${field.step ? `step="${field.step}"` : ''}
                               oninput="${config.calculate}('${id}')">
                        ${field.subtitle ? `<div class="subtitle">${field.subtitle}</div>` : ''}
                    </div>
                `).join('')}

                <div class="input-group">
                    <label>Costo de la soluci칩n (USD)</label>
                    <input type="number" 
                           id="${id}_costo_equipo" 
                           value="${equipmentCost || config.defaultCost}" 
                           step="0.01"
                           ${!canEditCost ? 'disabled' : ''}
                           oninput="${config.calculate}('${id}')">
                    ${!canEditCost ? '<div class="subtitle"></div>' : ''}
                </div>
                
                <div class="result-section">
                    <h3>Resultados Diarios</h3>
                    <div class="result-item">
                        <span class="result-label">Peso diario:</span>
                        <span class="result-value" id="${id}_peso_diario">0.00 kg</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Peso cargable con incidencia:</span>
                        <span class="result-value" id="${id}_peso_cargable">0.00 kg</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Venta con peso real:</span>
                        <span class="result-value" id="${id}_venta_real">0.00 USD</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Venta con peso cargable:</span>
                        <span class="result-value" id="${id}_venta_cargable">0.00 USD</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Diferencial de ingreso:</span>
                        <span class="result-value" id="${id}_diferencial_dia">0.00 USD</span>
                    </div>
                    
                    <h3 style="margin-top:20px">Resultados Mensuales (4 semanas, 5 d칤as/semana)</h3>
                    <div class="result-item">
                        <span class="result-label">Venta mensual con peso real:</span>
                        <span class="result-value" id="${id}_venta_real_mes">0.00 USD</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Venta mensual con peso cargable:</span>
                        <span class="result-value" id="${id}_venta_cargable_mes">0.00 USD</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Diferencial de ingreso mensual:</span>
                        <span class="result-value" id="${id}_diferencial_mes">0.00 USD</span>
                    </div>
                    
                    <div class="roi-highlight">
                        Recuperaci칩n de inversi칩n:<br>
                        <span id="${id}_roi">0.00 Meses</span>
                    </div>
                    <div style="text-align:center; margin-top:10px; color:#666;">
                        Costo equipo: $<span id="${id}_costo_display">${formatNumber(equipmentCost || config.defaultCost)}</span> USD
                    </div>
                </div>
            `;
            return html;
        }

        // C치lculo tipo 1 (con incidencia)
        function calculateType1(id) {
            const piezas = parseFloat(document.getElementById(`${id}_piezas`).value) || 0;
            const tarifa = parseFloat(document.getElementById(`${id}_tarifa`).value) || 0;
            const pesoPaquete = parseFloat(document.getElementById(`${id}_peso_paquete`).value) || 0;
            const incidencia = parseFloat(document.getElementById(`${id}_incidencia`).value) || 0;
            const costoEquipo = parseFloat(document.getElementById(`${id}_costo_equipo`).value) || 0;

            const pesoDiario = piezas * pesoPaquete;
            const pesoCargable = pesoDiario * (1 + incidencia / 100);
            const ventaReal = pesoDiario * tarifa;
            const ventaCargable = pesoCargable * tarifa;
            const diferencialDia = ventaCargable - ventaReal;

            const ventaRealMes = ventaReal * DIAS_MES;
            const ventaCargableMes = ventaCargable * DIAS_MES;
            const diferencialMes = diferencialDia * DIAS_MES;

            const roi = diferencialMes > 0 ? costoEquipo / diferencialMes : 0;

            updateResults(id, {
                pesoDiario, pesoCargable, ventaReal, ventaCargable, diferencialDia,
                ventaRealMes, ventaCargableMes, diferencialMes, roi, costoEquipo
            });
        }

        // C치lculo tipo 2 (con relaci칩n)
        function calculateType2(id) {
            const piezas = parseFloat(document.getElementById(`${id}_piezas`).value) || 0;
            const tarifa = parseFloat(document.getElementById(`${id}_tarifa`).value) || 0;
            const pesoPaquete = parseFloat(document.getElementById(`${id}_peso_paquete`).value) || 0;
            const relacion = parseFloat(document.getElementById(`${id}_relacion`).value) || 0;
            const costoEquipo = parseFloat(document.getElementById(`${id}_costo_equipo`).value) || 0;

            const pesoDiario = piezas * pesoPaquete;
            const pesoCargable = pesoDiario * relacion;
            const ventaReal = pesoDiario * tarifa;
            const ventaCargable = pesoCargable * tarifa;
            const diferencialDia = ventaCargable - ventaReal;

            const ventaRealMes = ventaReal * DIAS_MES;
            const ventaCargableMes = ventaCargable * DIAS_MES;
            const diferencialMes = diferencialDia * DIAS_MES;

            const roi = diferencialMes > 0 ? costoEquipo / diferencialMes : 0;

            updateResults(id, {
                pesoDiario, pesoCargable, ventaReal, ventaCargable, diferencialDia,
                ventaRealMes, ventaCargableMes, diferencialMes, roi, costoEquipo
            });
        }

        function updateResults(id, results) {
            document.getElementById(`${id}_peso_diario`).textContent = formatNumber(results.pesoDiario) + ' kg';
            document.getElementById(`${id}_peso_cargable`).textContent = formatNumber(results.pesoCargable) + ' kg';
            document.getElementById(`${id}_venta_real`).textContent = formatNumber(results.ventaReal) + ' USD';
            document.getElementById(`${id}_venta_cargable`).textContent = formatNumber(results.ventaCargable) + ' USD';
            document.getElementById(`${id}_diferencial_dia`).textContent = formatNumber(results.diferencialDia) + ' USD';
            document.getElementById(`${id}_venta_real_mes`).textContent = formatNumber(results.ventaRealMes) + ' USD';
            document.getElementById(`${id}_venta_cargable_mes`).textContent = formatNumber(results.ventaCargableMes) + ' USD';
            document.getElementById(`${id}_diferencial_mes`).textContent = formatNumber(results.diferencialMes) + ' USD';
            document.getElementById(`${id}_roi`).textContent = formatNumber(results.roi) + ' Meses';
            document.getElementById(`${id}_costo_display`).textContent = formatNumber(results.costoEquipo);
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('username');
            window.location.href = 'index.html';
        }

        // Cargar configuraci칩n al iniciar
        window.onload = loadUserConfig;
    </script>
</body>
</html>
